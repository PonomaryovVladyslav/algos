# –ó–∞–¥–∞—á–∞: –ü–æ–¥—Å—á–∏—Ç–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–∑–ª–æ–≤ –≤ –ø–æ–ª–Ω–æ–º –±–∏–Ω–∞—Ä–Ω–æ–º –¥–µ—Ä–µ–≤–µ.
# –î–∞–Ω–æ: –±–∏–Ω–∞—Ä–Ω–æ–µ –¥–µ—Ä–µ–≤–æ —Å –∫–æ—Ä–Ω–µ–º `root`.
# –ù—É–∂–Ω–æ: –≤–µ—Ä–Ω—É—Ç—å –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–∑–ª–æ–≤ –≤ –¥–µ—Ä–µ–≤–µ.

class TreeNode:
    """
    –ö–ª–∞—Å—Å —É–∑–ª–∞ –±–∏–Ω–∞—Ä–Ω–æ–≥–æ –¥–µ—Ä–µ–≤–∞.
    """
    def __init__(self, val: int = 0, left: "TreeNode" = None, right: "TreeNode" = None):
        self.val = val
        self.left = left
        self.right = right


def count_nodes(root: TreeNode) -> int:
    """
    –§—É–Ω–∫—Ü–∏—è –ø–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–∑–ª–æ–≤ –≤ –ø–æ–ª–Ω–æ–º –±–∏–Ω–∞—Ä–Ω–æ–º –¥–µ—Ä–µ–≤–µ.

    :param root: TreeNode - –∫–æ—Ä–µ–Ω—å –±–∏–Ω–∞—Ä–Ω–æ–≥–æ –¥–µ—Ä–µ–≤–∞.
    :return: int - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–∑–ª–æ–≤ –≤ –¥–µ—Ä–µ–≤–µ.
    """

    if not root:
        return 0

    left_height: int = 0
    right_height: int = 0
    left: TreeNode | None = root
    right: TreeNode | None = root

    # –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º –≤—ã—Å–æ—Ç—É –ª–µ–≤–æ–≥–æ –∏ –ø—Ä–∞–≤–æ–≥–æ –ø–æ–¥–¥–µ—Ä–µ–≤–∞
    while left:
        left = left.left
        left_height += 1

    while right:
        right = right.right
        right_height += 1

    if left_height == right_height:  # –ï—Å–ª–∏ –¥–µ—Ä–µ–≤–æ –ø–æ–ª–Ω–æ–µ
        return (1 << left_height) - 1  # 2^height - 1

    return 1 + count_nodes(root.left) + count_nodes(root.right)


# üîπ –¢–µ—Å—Ç–∏—Ä—É–µ–º
tree = TreeNode(1,
    TreeNode(2, TreeNode(4), TreeNode(5)),
    TreeNode(3, TreeNode(6))
)

print(count_nodes(tree))  # –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: 6

"""
–ê–Ω–∞–ª–∏–∑ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏:
- –í—Ä–µ–º–µ–Ω–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å: O(log^2 n), —Ç–∞–∫ –∫–∞–∫:
  - O(log n) —É—Ö–æ–¥–∏—Ç –Ω–∞ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –≤—ã—Å–æ—Ç—ã.
  - O(log n) –≤—ã–∑–æ–≤–æ–≤ —Ä–µ–∫—É—Ä—Å–∏–∏ –≤ —Ö—É–¥—à–µ–º —Å–ª—É—á–∞–µ (–ø–æ–ª–æ–≤–∏–Ω–∞ –ø–æ–¥–¥–µ—Ä–µ–≤—å–µ–≤).
  - –ò—Ç–æ–≥–æ–≤–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å: O(log n * log n).
- –ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å: O(log n), —Ç–∞–∫ –∫–∞–∫ —Ä–µ–∫—É—Ä—Å–∏—è —É–≥–ª—É–±–ª—è–µ—Ç—Å—è –Ω–∞ –≤—ã—Å–æ—Ç—É –¥–µ—Ä–µ–≤–∞.

üîπ –≠—Ç–æ—Ç –∞–ª–≥–æ—Ä–∏—Ç–º **—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ O(n)** –ø—Ä–∏ –ø–æ–ª–Ω–æ–º –¥–µ—Ä–µ–≤–µ, —Ç–∞–∫ –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **—Å–≤–æ–π—Å—Ç–≤–æ –≤—ã—Å–æ—Ç—ã**.
"""
